


<style>
    body{
        background-color: #382851;
    }
    #container{
        height:95vh;
    }
</style>
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="purple-theme.js"></script>
<div id="container"></div>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const state = urlParams.get('state');
    const id = urlParams.get('id');
    const round = urlParams.get('round');
    const typology = urlParams.get('typology');
    var mainData;
    (async () => {

    mainData = await fetch(
        `https://chartify.in/api/nfhs/data/${id}`
    ).then(response => response.json());

    function getMap(state,round){
        let map=''
        round=parseInt(round)
        if (state=='India'){
            if (round==5)
                map='india-2019'
            else if (round==4)
                map='india2018'
            else if (round==3)
                map='india2013'
            else
                map='india1999'
        }else if (state=='Bihar' || state=='Uttar Pradesh' || state=='Madhya Pradesh') {
            if (round>=4)
                map=state.toLowerCase()
            else if (round==3)
                map=state.toLowerCase()+'-2001'
            else
                map=state.toLowerCase()+'-1999'
            
        }else{
            map=state.toLowerCase()
        }
        console.log(map)
        return 'https://besnoi.github.io/maps/json/'+map+'.json'
    }

    const map  = getMap(state,round)

    const topology = await fetch(map).then(response => response.json());

    let data = []
    mainData[round].forEach(arg => {
        if (arg[typology]!='' && (state=='India' ?  arg['district']=='' : arg['state']==state))
            return data.push([state=='India' ? arg['state'] : arg['district'],parseInt(arg[typology])])
    })
    console.log(data)
    var identifier = mainData[round.toString()][0]['identifier'].replaceAll('-',' ').replace("non ","non-").replace('semi ','semi-').replace('check up','check-up').replace('out of pocket','out-of-pocket').replace('waist to hip','waist-to-hip').replace('HIV AIDS','HIV/AIDS')
    var unit = ''
    if (round==1)
        year='1992-1993'
    else if (round==2)
        year='1998-1999'
    else if (round==3)
        year='2005-2006'
    else if (round==4)
        year='2015-2016'
    else
        year='2019-2021'
    
    if (identifier.includes('percentage'))
        unit = 'Percentage'
    else if (identifier.includes('Rs.'))
        unit = 'Rupees'
    else
        unit = 'Rate'
        
    if (identifier.includes('percentage of'))
        identifier=identifier.replace('percentage of ','')+' (%)'

    Highcharts.mapChart('container', {
        chart: {
            map: topology
        },

        title: {
            text: identifier
        },

        credits:{
            enabled:false
        },

        subtitle: {
            text: 'Source map: NFHS-'+round+' ('+year+')'
        },

        mapNavigation: {
            enabled: true,
            buttonOptions: {
                verticalAlign: 'bottom'
            }
        },

        colorAxis: {
            minColor:'#CABAE5',
            maxColor:'#673AB7'
        },
        
        series: [{
            data: data,
            name: unit,
            states: {
                hover: {
                    color: '#BADA55'
                }
            },
            dataLabels: {
                enabled: false,
                format: '{point.name}'
            }
        }]
    });
    
})()
  </script>
  
